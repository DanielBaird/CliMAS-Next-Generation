!function t(i,e,s){function n(o,r){if(!e[o]){if(!i[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var p=e[o]={exports:{}};i[o][0].call(p.exports,function(t){var e=i[o][1][t];return n(e?e:t)},p,p.exports,t,i,e,s)}return e[o].exports}for(var a="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t){t("./mapview/main"),t("./menusandpanels"),$(function(){$("nav > ul").mspp({})})},{"./mapview/main":2,"./menusandpanels":6}],2:[function(t){(function(){var i;window.console||(window.console={log:function(){return{}}}),i=t("./views/app"),$(function(){var t;return t=new i,t.render()})}).call(this)},{"./views/app":5}],3:[function(t,i){(function(){var t;t=Backbone.Model.extend({constructor:function(t,i,e){return this.shortName=t,this.longName=i,this.path=e,null}}),i.exports=t}).call(this)},{}],4:[function(){(function(){var t=[].indexOf||function(t){for(var i=0,e=this.length;e>i;i++)if(i in this&&this[i]===t)return i;return-1};Array.prototype.forEach||(Array.prototype.forEach=function(i,e){var s,n,a,o;for(o=[],s=n=0,a=this.length;a>=0?a>=n:n>=a;s=a>=0?++n:--n)o.push(t.call(this,s)>=0?i.call(e,this[s],s,this):void 0);return o}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var i,e,s;for(i=e=0,s=this.length;s>=0?s>=e:e>=s;i=s>=0?++e:--e)if(this[i]===t)return i;return-1})}).call(this)},{}],5:[function(t,i){(function(){var e,s,n,a=[].indexOf||function(t){for(var i=0,e=this.length;e>i;i++)if(i in this&&this[i]===t)return i;return-1};s=t("../models/maplayer"),t("../util/shims"),n=function(t,i){var e,s,n,a;return e=["verydebug","debug","message","warning"],n="verydebug",i||(i="debug"),a=e.indexOf(n),s=e.indexOf(i),a>s?void 0:console.log(t+""===t?"["+i+"] "+t:t)},e=Backbone.View.extend({tagName:"div",className:"splitmap showforms",id:"splitmap",speciesDataUrl:""+location.protocol+"//"+location.host+"/speciesdata",rasterApiUrl:""+location.protocol+"//localhost:10600/api/raster/1/wms_data_url",trackSplitter:!1,trackPeriod:100,events:{"click .btn-change":"toggleForms","click .btn-compare":"toggleSplitter","click .btn-copy-ltr":"copyMapLeftToRight","click .btn-copy-rtl":"copyMapRightToLeft",leftmapupdate:"leftSideUpdate",rightmapupdate:"rightSideUpdate","change select.left":"leftSideUpdate","change select.right":"rightSideUpdate"},tick:function(){return setTimeout(this.tick,2e3)},initialize:function(){return n("AppView.initialize"),_.bindAll.apply(_,[this].concat(_.functions(this))),this.speciesInfoFetchProcess=this.fetchSpeciesInfo()},render:function(){return n("AppView.render"),this.$el.append(e.templates.layout({leftTag:e.templates.leftTag(),rightTag:e.templates.rightTag(),leftForm:e.templates.leftForm(),rightForm:e.templates.rightForm()})),$("#contentwrap").append(this.$el),this.map=L.map("map",{center:[-20,136],zoom:5}),this.map.on("move",this.resizeThings),L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{subdomains:"1234",maxZoom:18,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>,\ntiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>'}).addTo(this.map),this.leftForm=this.$(".left.form"),this.buildLeftForm(),this.rightForm=this.$(".right.form"),this.buildRightForm(),this.leftTag=this.$(".left.tag"),this.rightTag=this.$(".right.tag"),this.splitLine=this.$(".splitline"),this.splitThumb=this.$(".splitthumb")},copyMapLeftToRight:function(){return n("AppView.copyMapLeftToRight"),this.leftInfo?(this.$("#rightmapspp").val(this.leftInfo.speciesName),this.$("#rightmapyear").val(this.leftInfo.year),this.$("#rightmapscenario").val(this.leftInfo.scenario),this.$("#rightmapgcm").val(this.leftInfo.gcm),this.rightSideUpdate()):void 0},copyMapRightToLeft:function(){return n("AppView.copyMapRightToLeft"),this.rightInfo?(this.$("#leftmapspp").val(this.rightInfo.speciesName),this.$("#leftmapyear").val(this.rightInfo.year),this.$("#leftmapscenario").val(this.rightInfo.scenario),this.$("#leftmapgcm").val(this.rightInfo.gcm),this.leftSideUpdate()):void 0},leftSideUpdate:function(){var t,i;return n("AppView.leftSideUpdate"),i=this.$("#leftmapspp").val(),a.call(this.speciesSciNameList,i)>=0?(this.$(".btn-copy-rtl").prop("disabled",!1),t={speciesName:i,year:this.$("#leftmapyear").val(),scenario:this.$("#leftmapscenario").val(),gcm:this.$("#leftmapgcm").val()},this.leftInfo&&_.isEqual(t,this.leftInfo)?!1:this.leftInfo&&t.speciesName===this.leftInfo.speciesName&&t.year===this.leftInfo.year&&"baseline"===t.year?!1:(this.leftInfo=t,this.addMapLayer("left"),this.addMapTag("left"))):(this.$(".btn-copy-rtl").prop("disabled",!0),!1)},rightSideUpdate:function(){var t,i;return n("AppView.rightSideUpdate"),i=this.$("#rightmapspp").val(),a.call(this.speciesSciNameList,i)>=0?(this.$(".btn-copy-ltr").prop("disabled",!1),t={speciesName:i,year:this.$("#rightmapyear").val(),scenario:this.$("#rightmapscenario").val(),gcm:this.$("#rightmapgcm").val()},this.rightInfo&&_.isEqual(t,this.rightInfo)?!1:this.rightInfo&&t.speciesName===this.rightInfo.speciesName&&t.year===this.rightInfo.year&&"baseline"===t.year?!1:(this.rightInfo=t,this.addMapLayer("right"),this.addMapTag("right"))):(this.$(".btn-copy-ltr").prop("disabled",!0),!1)},addMapTag:function(t){var i,e;return n("AppView.addMapTag"),"left"===t&&(i=this.leftInfo),"right"===t&&(i=this.rightInfo),e="<b><i>"+i.speciesName+"</i></b>",e="baseline"===i.year?"current "+e+" distribution":"all"===i.gcm?"<b>median</b> projections for "+e+" in <b>"+i.year+"</b> if <b>"+i.scenario+"</b>":"<b>"+i.gcm+"</b> projections for "+e+" in <b>"+i.year+"</b> if <b>"+i.scenario+"</b>","left"===t&&this.leftTag.find(".leftlayername").html(e),"right"===t?this.rightTag.find(".rightlayername").html(e):void 0},addMapLayer:function(t){var i,e,s,a,o;return n("AppView.addMapLayer"),"left"===t&&(o=this.leftInfo),"right"===t&&(o=this.rightInfo),i=[o.scenario,o.gcm,o.year].join("_"),"baseline"===o.year&&(i="1990"),a=[this.speciesDataUrl,o.speciesName.replace(" ","_"),"output",i+".asc.gz"].join("/"),e=L.tileLayer.wms(this.rasterApiUrl,{DATA_URL:a,layers:"DEFAULT",format:"image/png",transparent:!0}),s=""+t+"loading",e.on("loading",function(t){return function(){return t.$el.addClass(s)}}(this)),e.on("load",function(t){return function(){return t.$el.removeClass(s)}}(this)),e.addTo(this.map),"left"===t&&(this.leftLayer&&this.map.removeLayer(this.leftLayer),this.leftLayer=e),"right"===t&&(this.rightLayer&&this.map.removeLayer(this.rightLayer),this.rightLayer=e),this.resizeThings()},centreMap:function(t){var i,e,s,a;for(n("AppView.centreMap"),t||(t=500),e=function(t){return function(){return t.map.invalidateSize(!1),t.resizeThings()}}(this),a=[],i=s=0;t>=s;i=s+=25)a.push(setTimeout(e,i));return a},toggleForms:function(){return n("AppView.toggleForms"),this.$el.toggleClass("showforms"),this.centreMap()},toggleSplitter:function(){return n("AppView.toggleSplitter"),this.$el.toggleClass("split"),this.$el.hasClass("split")?this.activateSplitter():this.deactivateSplitter(),this.centreMap()},fetchSpeciesInfo:function(){return n("AppView.fetchSpeciesInfo"),$.ajax({url:"/speciesdata/species.json"}).done(function(t){return function(i){var e,s,n;return s=[],n=[],e=function(t){var i;return i=" ("+t+")",function(e,n){return s.push({label:n+i,value:t})}},$.each(i,function(t,i){return n.push(t),i?$.each(i,e(t)):s.push({label:t,value:t})}),t.speciesLookupList=s,t.speciesSciNameList=n}}(this))},buildLeftForm:function(){return n("AppView.buildLeftForm"),this.speciesInfoFetchProcess.done(function(t){return function(){var i;return i=t.$("#leftmapspp"),i.autocomplete({source:t.speciesLookupList,appendTo:t.$el,close:function(){return t.$el.trigger("leftmapupdate")}})}}(this))},buildRightForm:function(){return n("AppView.buildRightForm"),this.speciesInfoFetchProcess.done(function(t){return function(){var i;return i=t.$("#rightmapspp"),i.autocomplete({source:t.speciesLookupList,appendTo:t.$el,close:function(){return t.$el.trigger("rightmapupdate")}})}}(this))},startSplitterTracking:function(){return n("AppView.startSplitterTracking"),this.trackSplitter=!0,this.splitLine.addClass("dragging"),this.locateSplitter()},locateSplitter:function(){return n("AppView.locateSplitter"),this.trackSplitter?(this.resizeThings(),0===this.trackSplitter?this.trackSplitter=!1:this.trackSplitter!==!0&&(this.trackSplitter-=1),setTimeout(this.locateSplitter,this.trackPeriod)):void 0},resizeThings:function(){var t,i,e,s,a,o,r,l,p,c,h,u,f,g;if(n("AppView.resizeThings"),this.leftLayer&&(o=$(this.leftLayer.getContainer())),this.rightLayer&&(c=$(this.rightLayer.getContainer())),this.$el.hasClass("split")){if(p=this.splitThumb.position().left+this.splitThumb.width()/2,l=this.map.getContainer(),t=$(l),r=l.getBoundingClientRect(),g=this.map.containerPointToLayerPoint([0,0]),u=this.map.containerPointToLayerPoint([p,0]),i=this.map.containerPointToLayerPoint([t.width(),t.height()]),s=g.y,e=i.y,f=u.x-r.left,a=g.x-r.left,h=i.x,this.splitLine.css("left",p),this.leftTag.attr("style","clip: rect(0, "+p+"px, auto, 0)"),this.leftLayer&&o.attr("style","clip: rect("+s+"px, "+f+"px, "+e+"px, "+a+"px)"),this.rightLayer)return c.attr("style","clip: rect("+s+"px, "+h+"px, "+e+"px, "+f+"px)")}else if(this.leftTag.attr("style","clip: inherit"),this.leftLayer&&o.attr("style","clip: inherit"),this.rightLayer)return c.attr("style","clip: rect(0,0,0,0)")},stopSplitterTracking:function(){return n("AppView.stopSplitterTracking"),this.splitLine.removeClass("dragging"),this.trackSplitter=5},activateSplitter:function(){return n("AppView.activateSplitter"),this.splitThumb.draggable({containment:$("#mapwrapper"),scroll:!1,start:this.startSplitterTracking,drag:this.resizeThings,stop:this.stopSplitterTracking}),this.resizeThings()},deactivateSplitter:function(){return n("AppView.deactivateSplitter"),this.splitThumb.draggable("destroy"),this.resizeThings()}},{templates:{layout:_.template('<div class="splitline">&nbsp;</div>\n<div class="splitthumb"><span>&#x276e; &#x276f;</span></div>\n<div class="left tag"><%= leftTag %></div>\n<div class="right tag"><%= rightTag %></div>\n<div class="left form"><%= leftForm %></div>\n<div class="right form"><%= rightForm %></div>\n<div class="left loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div class="right loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div id="mapwrapper"><div id="map"></div></div>'),leftTag:_.template('<div class="show">\n    <span class="leftlayername">plain map</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <input id="leftmapspp" name="leftmapspp" placeholder="&hellip; species or group &hellip;" />\n    <!--\n    <button class="btn-change">hide settings</button>\n    <button class="btn-compare">compare +/-</button>\n    -->\n</div>'),rightTag:_.template('<div class="show">\n    <span class="rightlayername">(no distribution)</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <input id="rightmapspp" name="rightmapspp" placeholder="&hellip; species or group &hellip;" />\n</div>'),leftForm:_.template('<p>\n<button class="btn-copy-rtl">copy right map &laquo;</button>\n</p><p>\n<select class="left" id="leftmapyear">\n    <option value="baseline">baseline</option>\n    <option value="2015">2015</option>\n    <option value="2035">2035</option>\n    <option value="2055">2055</option>\n    <option value="2075">2075</option>\n</select>\n</p><p>\n<select class="left" id="leftmapscenario">\n    <option>RCP3PD</option>\n    <option>RCP6</option>\n</select>\n</p><p>\n<select class="left" id="leftmapgcm">\n    <option value="all">median</option>\n    <option value="csiro-mk30">CSIRO Mark 3.0</option>\n</select>\n</p><p>\n<button class="btn-change">hide settings</button>\n</p><p>\n<button class="btn-compare">compare +/-</button>\n</p>'),rightForm:_.template('<p>\n<button class="btn-copy-ltr">&raquo; copy left map</button>\n</p><p>\n<select class="right" id="rightmapyear">\n    <option value="baseline">baseline</option>\n    <option value="2015">2015</option>\n    <option value="2035">2035</option>\n    <option value="2055">2055</option>\n    <option value="2075">2075</option>\n</select>\n</p><p>\n<select class="right" id="rightmapscenario">\n    <option>RCP3PD</option>\n    <option>RCP6</option>\n</select>\n</p><p>\n<select class="right" id="rightmapgcm">\n    <option value="all">median</option>\n    <option value="csiro-mk30">CSIRO Mark 3.0</option>\n</select>\n</p><p>\n<button class="btn-change">hide settings</button>\n</p><p>\n<button class="btn-compare">compare +/-</button>\n</p>')}}),i.exports=e}).call(this)},{"../models/maplayer":3,"../util/shims":4}],6:[function(){!function(t){t.widget("climas.mspp",{options:{animationFactor:2,mainMenuClass:"mspp-main-menu",panelClass:"mspp-panel",pageClass:"mspp-page",clearfixClass:"mspp-clearfix",activeClass:"current"},_create:function(){var i=this,e=this.options,s=this.element;this.mainMenuItems=s.children("li"),this.panels=t("."+e.panelClass),s.css({opacity:0}),this.panels.css({opacity:0}),s.addClass(e.mainMenuClass),s.addClass(e.clearfixClass),this.panels.addClass(e.clearfixClass),this._layoutMenu(),this._layoutPanels(),s.on("msppshowmenu",this._showMenu),s.on("msppshowsubmenu",this._showSubMenu),s.on("msppshowpanel",this._showPanel),s.on("msppshowpage",this._showPage),this.mainMenuItems.each(function(e,s){t(s).children("a").click(function(t){i._trigger("showmenu",t,{menuitem:s,widget:i})}),t(s).find("li").each(function(e,n){t(n).find("a").click(function(t){i._trigger("showsubmenu",t,{menuitem:s,submenuitem:n,widget:i})})})}),s.find("[data-targetpanel]").each(function(e,s){var n=t(s);n.click(function(e){i._trigger("showpanel",e,{panel:t("#"+n.data("targetpanel")).first(),widget:i})})}),this.panels.each(function(e,s){var n=t(s);n.find("[data-targetpage]").click(function(e){i._trigger("showpage",e,{panel:n,page:t("#"+t(this).data("targetpage")),widget:i})})});var n=this.mainMenuItems.filter("."+e.activeClass);n.removeClass(e.activeClass).children("a").click(),s.animate({opacity:1},"fast")},_switchClassOption:function(t,i){var e=this.options[t];if(e!==i){var s=this.element.find("."+e);this.options[t]=i,s.removeClass(e),s.addClass(i)}},_setOption:function(t,i){switch(t){case"mainMenuClass":case"clearfixClass":case"activeClass":this._switchClassOption(t,i);break;default:this.options[t]=i}this._super("_setOption",t,i)},_destroy:function(){this.element.removeClass(this.options.mainMenuClass),this.element.removeClass(this.options.clearfixClass),this.panels.removeClass(this.options.clearfixClass)},_layoutMenu:function(){this.element.find("ul").each(function(i,e){var s=t(e);s.css({width:"auto"}),s.data("originalWidth",s.width()),s.css({width:0,display:"none"})})},_showMenu:function(i,e){var s=t(e.menuitem),n=e.widget;if(s.hasClass(n.options.activeClass));else{n._hidePanels(),n.mainMenuItems.removeClass(n.options.activeClass);var a=s.find("ul"),o=n.element.find("ul").not(a),r=a.data("originalWidth");o.animate({width:0},50*n.options.animationFactor,function(){o.css({display:"none"})}),s.addClass(n.options.activeClass),a.css({display:"block"}).animate({width:r},125*n.options.animationFactor,function(){a.css({width:"auto"}).removeAttr("style"),n._trigger("menushown",i,{item:s,widget:n})}),a.find("."+n.options.activeClass+" a").click()}},_showSubMenu:function(i,e){t(e.menuitem).find("li").removeClass(e.widget.options.activeClass),t(e.submenuitem).addClass(e.widget.options.activeClass)},_layoutPanels:function(){var i=this.panels.find("."+this.options.pageClass);i.each(function(i,e){var s=t(e);s.css({height:"auto"}),s.data("originalHeight",s.outerHeight()),s.css({height:0,display:"none"})}),this.panels.each(function(i,e){var s=t(e);s.css({display:"none"})})},_hidePanels:function(){this.panels.removeClass(this.options.activeClass).css({display:"none",height:0})},_showPanel:function(i,e){var s=t(e.panel),n=e.widget;if(s.hasClass(n.options.activeClass));else{n._hidePanels(),s.addClass(n.options.activeClass),s.css({display:"block",opacity:1});var a=t(s.find("."+n.options.pageClass+"."+n.options.activeClass));n._trigger("showpage",i,{panel:s,page:a,widget:n})}},_showPage:function(i,e){var s=e.widget,n=t(e.panel),a=t(e.page),o=a.data("originalHeight");n.css({height:n.height()});var r=n.find("."+s.options.pageClass+"."+s.options.activeClass).not(a);r.length>0&&(r.data("originalHeight",r.outerHeight()),r.removeClass(s.options.activeClass).fadeOut(50*s.options.animationFactor,function(){r.css({height:0})})),a.css({height:"auto"}).addClass(s.options.activeClass).fadeIn(100*s.options.animationFactor,function(){a.removeAttr("style")});var l=r.length>0?100*s.options.animationFactor:150*s.options.animationFactor;n.animate({height:o},l,function(){n.removeAttr("style")})},_:null})}(jQuery,window,document)},{}]},{},[1]);