!function t(e,i,n){function a(r,p){if(!i[r]){if(!e[r]){var o="function"==typeof require&&require;if(!p&&o)return o(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return a(i?i:t)},l,l.exports,t,e,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(t){t("./mapview/main"),$("header").disableSelection(),$("nav > ul").mspp({})},{"./mapview/main":2}],2:[function(t){var e;window.console||(window.console={log:function(){return{}}}),e=t("./views/app"),$(function(){var t;return t=new e,t.render()})},{"./views/app":4}],3:[function(t,e){var i;i=Backbone.Model.extend({constructor:function(t,e,i){return this.shortName=t,this.longName=e,this.path=i,null}}),e.exports=i},{}],4:[function(t,e){var i,n,a,s=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};n=t("../models/maplayer"),a=function(t,e){var i,n,a,s;return i=["debug","message","warning"],a="debug",e||(e=i[0]),s=i.indexOf(a),n=i.indexOf(e),s>n?void 0:console.log(t+""===t?"["+e+"] "+t:t)},i=Backbone.View.extend({tagName:"div",className:"splitmap showforms",id:"splitmap",trackSplitter:!1,trackPeriod:100,events:{"click .btn-change":"toggleForms","click .btn-compare":"toggleSplitter",leftmapupdate:"leftSideUpdate",rightmapupdate:"rightSideUpdate","change select.left":"leftSideUpdate","change select.right":"rightSideUpdate"},tick:function(){return setTimeout(this.tick,2e3)},initialize:function(){return a("AppView.initialize"),this.mapLayer=new n("left","Left Map","left.map"),_.bindAll.apply(_,[this].concat(_.functions(this))),this.speciesInfoFetchProcess=this.fetchSpeciesInfo()},render:function(){return a("AppView.render"),this.$el.append(i.templates.layout({leftTag:i.templates.leftTag(),rightTag:i.templates.rightTag(),leftForm:i.templates.leftForm(),rightForm:i.templates.rightForm()})),$("#contentwrap").append(this.$el),this.map=L.map("map",{center:[-20,136],zoom:5}),this.map.on("move",this.resizeThings),L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{subdomains:"1234",maxZoom:18,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>,\ntiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>'}).addTo(this.map),this.leftForm=this.$(".left.form"),this.buildLeftForm(),this.rightForm=this.$(".right.form"),this.buildRightForm(),this.leftTag=this.$(".left.tag"),this.rightTag=this.$(".right.tag"),this.splitLine=this.$(".splitline"),this.splitThumb=this.$(".splitthumb")},leftSideUpdate:function(){var t,e;return a("AppView.leftSideUpdate"),e=this.$("#leftmapspp").val(),s.call(this.speciesSciNameList,e)<0?!1:(t={speciesName:e,year:this.$("#leftmapyear").val(),scenario:this.$("#leftmapscenario").val(),gcm:this.$("#leftmapgcm").val()},this.leftInfo&&_.isEqual(t,this.leftInfo)?!1:this.leftInfo&&t.speciesName===this.leftInfo.speciesName&&t.year===this.leftInfo.year&&"baseline"===t.year?!1:(this.leftInfo=t,this.addMapLayer("left"),this.addMapTag("left")))},rightSideUpdate:function(){var t,e;return a("AppView.rightSideUpdate"),e=this.$("#rightmapspp").val(),s.call(this.speciesSciNameList,e)<0?!1:(t={speciesName:e,year:this.$("#rightmapyear").val(),scenario:this.$("#rightmapscenario").val(),gcm:this.$("#rightmapgcm").val()},this.rightInfo&&_.isEqual(t,this.rightInfo)?!1:this.rightInfo&&t.speciesName===this.rightInfo.speciesName&&t.year===this.rightInfo.year&&"baseline"===t.year?!1:(this.rightInfo=t,this.addMapLayer("right"),this.addMapTag("right")))},addMapTag:function(t){var e,i;return a("AppView.addMapTag"),"left"===t&&(e=this.leftInfo),"right"===t&&(e=this.rightInfo),i="<b><i>"+e.speciesName+"</i></b>",i="baseline"===e.year?"current "+i+" distribution":"all"===e.gcm?"<b>median</b> projections for "+i+" in <b>"+e.year+"</b> if <b>"+e.scenario+"</b>":"<b>"+e.gcm+"</b> projections for "+i+" in <b>"+e.year+"</b> if <b>"+e.scenario+"</b>","left"===t&&this.leftTag.find(".leftlayername").html(i),"right"===t?this.rightTag.find(".rightlayername").html(i):void 0},addMapLayer:function(t){var e,i,n,s,r;return a("AppView.addMapLayer"),"left"===t&&(r=this.leftInfo),"right"===t&&(r=this.rightInfo),e=[r.scenario,r.gcm,r.year].join("_"),"baseline"===r.year&&(e="1990"),s="http://localhost:10600/api/raster/1/wms_data_url",n=["http://localhost:6543/speciesdata",r.speciesName.replace(" ","_"),"output",e+".asc.gz"].join("/"),i=L.tileLayer.wms(s,{DATA_URL:n,layers:"DEFAULT",format:"image/png",transparent:!0}),i.addTo(this.map),"left"===t&&(this.leftLayer&&this.map.removeLayer(this.leftLayer),this.leftLayer=i),"right"===t&&(this.rightLayer&&this.map.removeLayer(this.rightLayer),this.rightLayer=i),this.resizeThings()},centreMap:function(t){var e,i,n,s;for(a("AppView.centreMap"),t||(t=500),i=function(t){return function(){return t.map.invalidateSize(!1),t.resizeThings()}}(this),s=[],e=n=0;t>=n;e=n+=25)s.push(setTimeout(i,e));return s},toggleForms:function(){return a("AppView.toggleForms"),this.$el.toggleClass("showforms"),this.centreMap()},toggleSplitter:function(){return a("AppView.toggleSplitter"),this.$el.toggleClass("split"),this.$el.hasClass("split")?this.activateSplitter():this.deactivateSplitter(),this.centreMap()},fetchSpeciesInfo:function(){return a("AppView.fetchSpeciesInfo"),$.ajax({url:"/speciesdata/species.json"}).done(function(t){return function(e){var i,n,a;return n=[],a=[],i=function(t){var e;return e=" ("+t+")",function(i,a){return n.push({label:a+e,value:t})}},$.each(e,function(t,e){return a.push(t),e?$.each(e,i(t)):n.push({label:t,value:t})}),t.speciesLookupList=n,t.speciesSciNameList=a}}(this))},buildLeftForm:function(){return a("AppView.buildLeftForm"),this.speciesInfoFetchProcess.done(function(t){return function(){var e;return e=t.$("#leftmapspp"),e.autocomplete({source:t.speciesLookupList,appendTo:t.$el,close:function(){return t.$el.trigger("leftmapupdate")}})}}(this))},buildRightForm:function(){return a("AppView.buildRightForm"),this.speciesInfoFetchProcess.done(function(t){return function(){var e;return e=t.$("#rightmapspp"),e.autocomplete({source:t.speciesLookupList,appendTo:t.$el,close:function(){return t.$el.trigger("rightmapupdate")}})}}(this))},startSplitterTracking:function(){return a("AppView.startSplitterTracking"),this.trackSplitter=!0,this.splitLine.addClass("dragging"),this.locateSplitter()},locateSplitter:function(){return a("AppView.locateSplitter"),this.trackSplitter?(this.resizeThings(),0===this.trackSplitter?this.trackSplitter=!1:this.trackSplitter!==!0&&(this.trackSplitter-=1),setTimeout(this.locateSplitter,this.trackPeriod)):void 0},resizeThings:function(){var t,e,i,n,s,r,p,o,l,h,c,u,f,g;if(a("AppView.resizeThings"),this.leftLayer&&(r=$(this.leftLayer.getContainer())),this.rightLayer&&(h=$(this.rightLayer.getContainer())),this.$el.hasClass("split")){if(l=this.splitThumb.position().left+this.splitThumb.width()/2,o=this.map.getContainer(),t=$(o),p=o.getBoundingClientRect(),g=this.map.containerPointToLayerPoint([0,0]),u=this.map.containerPointToLayerPoint([l,0]),e=this.map.containerPointToLayerPoint([t.width(),t.height()]),n=g.y,i=e.y,f=u.x-p.left,s=g.x-p.left,c=e.x,this.splitLine.css("left",l),this.leftTag.css("clip","rect(0 "+l+"px auto 0)"),this.leftLayer&&r.css("clip","rect("+n+"px "+f+"px "+i+"px "+s+"px)"),this.rightLayer)return h.css("clip","rect("+n+"px "+c+"px "+i+"px "+f+"px)")}else if(this.leftTag.css("clip","inherit"),this.leftLayer&&r.css("clip","inherit"),this.rightLayer)return h.css("clip","rect(0,0,0,0)")},stopSplitterTracking:function(){return a("AppView.stopSplitterTracking"),this.splitLine.removeClass("dragging"),this.trackSplitter=5},activateSplitter:function(){return a("AppView.activateSplitter"),this.splitThumb.draggable({containment:$("#mapwrapper"),scroll:!1,start:this.startSplitterTracking,drag:this.resizeThings,stop:this.stopSplitterTracking}),this.resizeThings()},deactivateSplitter:function(){return a("AppView.deactivateSplitter"),this.splitThumb.draggable("destroy"),this.resizeThings()}},{templates:{layout:_.template('<div class="splitline"></div>\n<div class="splitthumb"><span>&#x276e; &#x276f;</span></div>\n<div class="left tag"><%= leftTag %></div>\n<div class="right tag"><%= rightTag %></div>\n<div class="left form"><%= leftForm %></div>\n<div class="right form"><%= rightForm %></div>\n<div id="mapwrapper"><div id="map"></div></div>'),leftTag:_.template('<div class="show">\n    <span class="leftlayername">plain map</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <input id="leftmapspp" name="leftmapspp" placeholder="&hellip; species or group &hellip;" />\n    <button class="btn-change">done</button>\n    <button class="btn-compare">compare +/-</button>\n</div>'),rightTag:_.template('<div class="show">\n    <span class="rightlayername">(no distribution)</span>\n</div>\n<div class="edit">\n    <input id="rightmapspp" name="rightmapspp" placeholder="&hellip; species or group &hellip;" />\n</div>'),leftForm:_.template('<p>\n<select class="left" id="leftmapyear">\n    <option value="baseline">baseline</option>\n    <option value="2015">2015</option>\n    <option value="2035">2035</option>\n    <option value="2055">2055</option>\n    <option value="2075">2075</option>\n</select>\n</p><p>\n<select class="left" id="leftmapscenario">\n    <option>RCP3PD</option>\n    <option>RCP6</option>\n</select>\n</p><p>\n<select class="left" id="leftmapgcm">\n    <option value="all">median</option>\n    <option value="csiro-mk30">CSIRO Mark 3.0</option>\n</select>\n</p><p>\n<button class="btn-change">done</button>\n</p><p>\n<button class="btn-compare">compare + / -</button>\n</p>'),rightForm:_.template('<p>\n<select class="right" id="rightmapyear">\n    <option value="baseline">baseline</option>\n    <option value="2015">2015</option>\n    <option value="2035">2035</option>\n    <option value="2055">2055</option>\n    <option value="2075">2075</option>\n</select>\n</p><p>\n<select class="right" id="rightmapscenario">\n    <option>RCP3PD</option>\n    <option>RCP6</option>\n</select>\n</p><p>\n<select class="right" id="rightmapgcm">\n    <option value="all">median</option>\n    <option value="csiro-mk30">CSIRO Mark 3.0</option>\n</select>\n</p><p>\n<button class="btn-change">done</button>\n</p><p>\n<button class="btn-compare">compare +/-</button>\n</p>')}}),e.exports=i},{"../models/maplayer":3}]},{},[1]);